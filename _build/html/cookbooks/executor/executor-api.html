<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark">
  <meta property="og:title" content="Executor API" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://docs.jina.ai/cookbooks/executor/executor-api.html" />
  <meta property="og:site_name" content="Jina Documentation" />
  <meta property="og:description" content="Executor process DocumentArray in-place via functions decorated with@requests. An Executor should subclass directly from jina.Executor class., An Executor class is a bag of functions with shared state (via self); it can contain an arbitrary number of functions with arbitrary names., Functions dec..." />
  <meta property="og:image" content="https://docs.jina.ai/_static/banner.png" />
  <meta property="og:image:alt" content="Jina Documentation" />
  <meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@JinaAI_">
<meta name="twitter:creator" content="@JinaAI_">
<meta name="description" content="Jina is the cloud-native neural search solution powered by the state-of-the-art AI and deep learning">
<meta property="og:description" content="Jina is the cloud-native neural search solution powered by the state-of-the-art AI and deep learning">

    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-48ZDWC8GT6"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-48ZDWC8GT6');
</script>
    <link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" /><link rel="next" title="Executor Built-in Features" href="executor-built-in-features.html" /><link rel="prev" title="Executor" href="index.html" />

    <meta name="generator" content="sphinx-3.5.3, furo 2021.06.18.beta36"/>
        <title>Executor API - Welcome to Jina</title>
      <link rel="stylesheet" href="../../_static/styles/furo.css?digest=9b17055c4366e8b2949c66d6a9d8b0efe4dbaa60">
    <link rel="stylesheet" href="../../_static/pygments.css">
    


<style>
  :root {
    --color-code-background: #ffffff;
  --color-code-foreground: #4d4d4d;
  --color-brand-primary: #009191;
  --color-brand-content: #009191;
  
  }
  @media (prefers-color-scheme: dark) {
    :root {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #FBCB67;
  --color-brand-content: #FBCB67;
  
    }
  }

  /* For allowing end-user-specific overrides */
  .override-light {
    --color-code-background: #ffffff;
  --color-code-foreground: #4d4d4d;
  --color-brand-primary: #009191;
  --color-brand-content: #009191;
  
  }
  .override-dark {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #FBCB67;
  --color-brand-content: #FBCB67;
  
  }
</style><link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.d53ab927f7bad3eaa42da95908504b10.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/main.css" />
    <link media="(prefers-color-scheme: dark)" rel="stylesheet" href="../../_static/pygments_dark.css">
    <link rel="stylesheet" href="../../_static/styles/furo-extensions.css?digest=ee12cdd73c4bbac24afec78d92c4afd7c2d8ea7f"></head>
  <body dir="">
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke-width="1.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z"/>
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">Welcome to Jina</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="../../_static/logo-new.gif" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="../../_static/logo-new.gif" alt="Dark Logo"/>
  </div>
  
  
</a><form class="sidebar-search-container" method="get" action="../../search.html">
  <input class="sidebar-search" placeholder=Search name="q">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption"><span class="caption-text">Cookbooks</span></p>
<ul class="current">
<li class="toctree-l1 has-children"><a class="reference internal" href="../document/index.html">Document/DocumentArray</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label for="toctree-checkbox-1"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../document/document-api.html">Document API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../document/documentarray-api.html">DocumentArray API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../document/documentarraymemmap-api.html">DocumentArrayMemmap API</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">Executor</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label for="toctree-checkbox-2"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Executor API</a></li>
<li class="toctree-l2"><a class="reference internal" href="executor-built-in-features.html">Executor Built-in Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="executors-in-action.html">Executors in Action</a></li>
<li class="toctree-l2"><a class="reference internal" href="repository-structure.html">Structure of the Repository</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../flow/index.html">Flow</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label for="toctree-checkbox-3"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../flow/flow-api.html">Flow API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../flow/remarks.html">Remarks</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../hub/index.html">JinaHub</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label for="toctree-checkbox-4"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../hub/prerequisites.html">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hub/create-hub-executor.html">1. Create Hub Executor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hub/push-executor.html">2. Push Executor to JinaHub</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hub/update-executor.html">3. Update Executor in JinaHub</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hub/pull-executor.html">4. Pull Executor from JinaHub</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hub/use-hub-executor.html">5. Use in Jina Flow</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../daemon/index.html">JinaD</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label for="toctree-checkbox-5"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../daemon/setup-jinad-server.html">Setup JinaD Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daemon/start-jinad-client.html">Start JinaD Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daemon/workspace.html">Workspace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daemon/create-remote-executors.html">Create Remote Executors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daemon/create-remote-flows.html">Create Remote Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daemon/stream-remote-logs.html">Streaming Remote Logs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daemon/development-using-jinad.html">Development using JinaD</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../math/index.html">Jina Math</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label for="toctree-checkbox-6"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../math/distances.html">Distances</a></li>
<li class="toctree-l2"><a class="reference internal" href="../math/dimension-reduction.html">Dimension Reduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../math/other-helpers.html">Other helpers</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../serving/index.html">Serving Jina</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label for="toctree-checkbox-7"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../serving/flow-as-a-service.html">Flow-as-a-service</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../clean-code/index.html">Writing Clean &amp; Efficient Code with Jina</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../cli/index.html">Jina Command-Line Interface</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../proto/index.html">Jina Protobuf Specification</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label for="toctree-checkbox-8"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="simple">
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/jina-ai/jina#read-tutorials">Tutorials</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/jina-ai/jina">GitHub repository</a></li>
<li class="toctree-l1"><a class="reference external" href="https://slack.jina.ai">Slack community</a></li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <article role="main">
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <div class="section" id="executor-api">
<h1>Executor API<a class="headerlink" href="#executor-api" title="Permalink to this headline">¶</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">Executor</span></code> process <code class="docutils literal notranslate"><span class="pre">DocumentArray</span></code> in-place via functions decorated with <code class="docutils literal notranslate"><span class="pre">@requests</span></code>.</p>
<ul class="simple">
<li><p>An <code class="docutils literal notranslate"><span class="pre">Executor</span></code> should subclass directly from <code class="docutils literal notranslate"><span class="pre">jina.Executor</span></code> class.</p></li>
<li><p>An <code class="docutils literal notranslate"><span class="pre">Executor</span></code> class is a bag of functions with shared state (via <code class="docutils literal notranslate"><span class="pre">self</span></code>); it can contain an arbitrary number of
functions with arbitrary names.</p></li>
<li><p>Functions decorated by <code class="docutils literal notranslate"><span class="pre">@requests</span></code> will be invoked according to their <code class="docutils literal notranslate"><span class="pre">on=</span></code> endpoint.</p></li>
</ul>
<div class="section" id="inheritance">
<h2>Inheritance<a class="headerlink" href="#inheritance" title="Permalink to this headline">¶</a></h2>
<p>Every new executor should be inherited directly from <code class="docutils literal notranslate"><span class="pre">jina.Executor</span></code>.</p>
<p>You can name your executor class freely.</p>
</div>
<div class="section" id="init-constructor">
<h2><code class="docutils literal notranslate"><span class="pre">__init__</span></code> Constructor<a class="headerlink" href="#init-constructor" title="Permalink to this headline">¶</a></h2>
<p>If your executor defines <code class="docutils literal notranslate"><span class="pre">__init__</span></code>, it needs to carry <code class="docutils literal notranslate"><span class="pre">**kwargs</span></code> in the signature and call <code class="docutils literal notranslate"><span class="pre">super().__init__(**kwargs)</span></code>
in the body:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jina</span> <span class="kn">import</span> <span class="n">Executor</span>


<span class="k">class</span> <span class="nc">MyExecutor</span><span class="p">(</span><span class="n">Executor</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">foo</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">bar</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bar</span> <span class="o">=</span> <span class="n">bar</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">foo</span> <span class="o">=</span> <span class="n">foo</span>
</pre></div>
</div>
<p>Here, <code class="docutils literal notranslate"><span class="pre">kwargs</span></code> contains <code class="docutils literal notranslate"><span class="pre">metas</span></code> and <code class="docutils literal notranslate"><span class="pre">requests</span></code> (representing the request-to-function mapping) values from the YAML
config and <code class="docutils literal notranslate"><span class="pre">runtime_args</span></code> injected on startup. Note that you can access their values in <code class="docutils literal notranslate"><span class="pre">__init__</span></code> body via <code class="docutils literal notranslate"><span class="pre">self.metas</span></code>
/<code class="docutils literal notranslate"><span class="pre">self.requests</span></code>/<code class="docutils literal notranslate"><span class="pre">self.runtime_args</span></code>, or modifying their values before sending to <code class="docutils literal notranslate"><span class="pre">super().__init__()</span></code>.</p>
<p>No need to implement <code class="docutils literal notranslate"><span class="pre">__init__</span></code> if your <code class="docutils literal notranslate"><span class="pre">Executor</span></code> does not contain initial states.</p>
</div>
<div class="section" id="method-naming">
<h2>Method naming<a class="headerlink" href="#method-naming" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">Executor</span></code>’s methods can be named freely. Methods that are not decorated with <code class="docutils literal notranslate"><span class="pre">@requests</span></code> are irrelevant to Jina.</p>
</div>
<div class="section" id="requests-decorator">
<h2><code class="docutils literal notranslate"><span class="pre">@requests</span></code> decorator<a class="headerlink" href="#requests-decorator" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">@requests</span></code> defines when a function will be invoked. It has a keyword <code class="docutils literal notranslate"><span class="pre">on=</span></code> to define the endpoint.</p>
<p>To call an Executor’s function, uses <code class="docutils literal notranslate"><span class="pre">Flow.post(on=...,</span> <span class="pre">...)</span></code>. For example, given:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jina</span> <span class="kn">import</span> <span class="n">Executor</span><span class="p">,</span> <span class="n">Flow</span><span class="p">,</span> <span class="n">Document</span><span class="p">,</span> <span class="n">requests</span>


<span class="k">class</span> <span class="nc">MyExecutor</span><span class="p">(</span><span class="n">Executor</span><span class="p">):</span>

    <span class="nd">@requests</span><span class="p">(</span><span class="n">on</span><span class="o">=</span><span class="s1">'/index'</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'foo is called: </span><span class="si">{</span><span class="n">kwargs</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>

    <span class="nd">@requests</span><span class="p">(</span><span class="n">on</span><span class="o">=</span><span class="s1">'/random_work'</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">bar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'bar is called: </span><span class="si">{</span><span class="n">kwargs</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>


<span class="n">f</span> <span class="o">=</span> <span class="n">Flow</span><span class="p">()</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">uses</span><span class="o">=</span><span class="n">MyExecutor</span><span class="p">)</span>

<span class="k">with</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">on</span><span class="o">=</span><span class="s1">'/index'</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">Document</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s1">'index'</span><span class="p">))</span>
    <span class="n">f</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">on</span><span class="o">=</span><span class="s1">'/random_work'</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">Document</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s1">'random_work'</span><span class="p">))</span>
    <span class="n">f</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">on</span><span class="o">=</span><span class="s1">'/blah'</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">Document</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s1">'blah'</span><span class="p">))</span> 
</pre></div>
</div>
<p>Then:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">f.post(on='/index',</span> <span class="pre">...)</span></code> will trigger <code class="docutils literal notranslate"><span class="pre">MyExecutor.foo</span></code>;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">f.post(on='/random_work',</span> <span class="pre">...)</span></code> will trigger <code class="docutils literal notranslate"><span class="pre">MyExecutor.bar</span></code>;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">f.post(on='/blah',</span> <span class="pre">...)</span></code> will not trigger any function, as no function is bound to <code class="docutils literal notranslate"><span class="pre">/blah</span></code>;</p></li>
</ul>
<div class="section" id="default-binding-requests-without-on">
<h3>Default binding: <code class="docutils literal notranslate"><span class="pre">@requests</span></code> without <code class="docutils literal notranslate"><span class="pre">on=</span></code><a class="headerlink" href="#default-binding-requests-without-on" title="Permalink to this headline">¶</a></h3>
<p>A class method decorated with plain <code class="docutils literal notranslate"><span class="pre">@requests</span></code> (without <code class="docutils literal notranslate"><span class="pre">on=</span></code>) is the default handler for all endpoints. That means it
is the fallback handler for endpoints that are not found. <code class="docutils literal notranslate"><span class="pre">f.post(on='/blah',</span> <span class="pre">...)</span></code> will invoke <code class="docutils literal notranslate"><span class="pre">MyExecutor.foo</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jina</span> <span class="kn">import</span> <span class="n">Executor</span><span class="p">,</span> <span class="n">requests</span>


<span class="k">class</span> <span class="nc">MyExecutor</span><span class="p">(</span><span class="n">Executor</span><span class="p">):</span>

    <span class="nd">@requests</span>
    <span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@requests</span><span class="p">(</span><span class="n">on</span><span class="o">=</span><span class="s1">'/index'</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">bar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="multiple-bindings-requests-on">
<h3>Multiple bindings: <code class="docutils literal notranslate"><span class="pre">@requests(on=[...])</span></code><a class="headerlink" href="#multiple-bindings-requests-on" title="Permalink to this headline">¶</a></h3>
<p>To bind a method with multiple endpoints, you can use <code class="docutils literal notranslate"><span class="pre">@requests(on=['/foo',</span> <span class="pre">'/bar'])</span></code>. This allows
either <code class="docutils literal notranslate"><span class="pre">f.post(on='/foo',</span> <span class="pre">...)</span></code> or <code class="docutils literal notranslate"><span class="pre">f.post(on='/bar',</span> <span class="pre">...)</span></code> to invoke that function.</p>
</div>
<div class="section" id="no-binding">
<h3>No binding<a class="headerlink" href="#no-binding" title="Permalink to this headline">¶</a></h3>
<p>A class with no <code class="docutils literal notranslate"><span class="pre">@requests</span></code> binding plays no part in the Flow. The request will simply pass through without any
processing.</p>
</div>
</div>
<div class="section" id="method-signature">
<h2>Method Signature<a class="headerlink" href="#method-signature" title="Permalink to this headline">¶</a></h2>
<p>Class method decorated by <code class="docutils literal notranslate"><span class="pre">@request</span></code> follows the signature below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">docs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DocumentArray</span><span class="p">],</span>
        <span class="n">parameters</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
        <span class="n">docs_matrix</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DocumentArray</span><span class="p">],</span>
        <span class="n">groundtruths</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DocumentArray</span><span class="p">],</span>
        <span class="n">groundtruths_matrix</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DocumentArray</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DocumentArray</span><span class="p">]:</span>
    <span class="k">pass</span>
</pre></div>
</div>
</div>
<div class="section" id="method-arguments">
<h2>Method Arguments<a class="headerlink" href="#method-arguments" title="Permalink to this headline">¶</a></h2>
<p>The Executor’s method receive the following arguments in order:</p>
<div class="table-wrapper"><table border="1" class="docutils">
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>docs</code></td>
<td><code>Optional[DocumentArray]</code></td>
<td><code>Request.docs</code>. When multiple requests are available, it is a concatenation of all <code>Request.docs</code> as one <code>DocumentArray</code>. When <code>DocumentArray</code> has zero element, then it is <code>None</code>.</td>
</tr>
<tr>
<td><code>parameters</code></td>
<td><code>Dict</code></td>
<td><code>Request.parameters</code>, given by <code>Flow.post(..., parameters=)</code></td>
</tr>
<tr>
<td><code>docs_matrix</code></td>
<td><code>List[DocumentArray]</code></td>
<td>When multiple requests are available, it is a list of all <code>Request.docs</code>. On single request, it is <code>None</code></td>
</tr>
<tr>
<td><code>groundtruths</code></td>
<td><code>Optional[DocumentArray]</code></td>
<td><code>Request.groundtruths</code>. Same behavior as <code>docs</code></td>
</tr>
<tr>
<td><code>groundtruths_matrix</code></td>
<td><code>List[DocumentArray]</code></td>
<td>Same behavior as <code>docs_matrix</code> but on <code>Request.groundtruths</code></td>
</tr>
</tbody>
</table></div>
<p>Note, executor’s methods not decorated with <code class="docutils literal notranslate"><span class="pre">@request</span></code> do not enjoy these arguments.</p>
<p>The arguments order is designed as common-usage-first. Not alphabetical order or semantic closeness.</p>
<p>If you don’t need some arguments, you can suppress them into <code class="docutils literal notranslate"><span class="pre">**kwargs</span></code>. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jina</span> <span class="kn">import</span> <span class="n">Executor</span><span class="p">,</span> <span class="n">requests</span>


<span class="k">class</span> <span class="nc">MyExecutor</span><span class="p">(</span><span class="n">Executor</span><span class="p">):</span>

    <span class="nd">@requests</span>
    <span class="k">def</span> <span class="nf">foo_using_docs_arg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>

    <span class="nd">@requests</span>
    <span class="k">def</span> <span class="nf">foo_using_docs_parameters_arg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>

    <span class="nd">@requests</span>
    <span class="k">def</span> <span class="nf">foo_using_no_arg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># the args are suppressed into kwargs</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">'docs_matrix'</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="method-returns">
<h2>Method Returns<a class="headerlink" href="#method-returns" title="Permalink to this headline">¶</a></h2>
<p>Methods decorated with <code class="docutils literal notranslate"><span class="pre">@request</span></code> can return <code class="docutils literal notranslate"><span class="pre">Optional[DocumentArray]</span></code>.</p>
<p>The return is optional. <strong>All changes happen in-place.</strong></p>
<ul class="simple">
<li><p>If the return is not <code class="docutils literal notranslate"><span class="pre">None</span></code>, then the current <code class="docutils literal notranslate"><span class="pre">docs</span></code> field in the <code class="docutils literal notranslate"><span class="pre">Request</span></code> will be overridden by the
returned <code class="docutils literal notranslate"><span class="pre">DocumentArray</span></code>, which will be forwarded to the next Executor in the Flow.</p></li>
<li><p>If the return is just a shallow copy of <code class="docutils literal notranslate"><span class="pre">Request.docs</span></code>, then nothing happens. This is because the changes are already
made in-place, there is no point to assign the value.</p></li>
</ul>
<p>So do I need a return? No, unless you must create a new <code class="docutils literal notranslate"><span class="pre">DocumentArray</span></code>. Let’s see some examples.</p>
<div class="section" id="example-1-embed-documents-blob">
<h3>Example 1: Embed Documents <code class="docutils literal notranslate"><span class="pre">blob</span></code><a class="headerlink" href="#example-1-embed-documents-blob" title="Permalink to this headline">¶</a></h3>
<p>In this example, <code class="docutils literal notranslate"><span class="pre">encode()</span></code> uses some neural network to get the embedding for each <code class="docutils literal notranslate"><span class="pre">Document.blob</span></code>, then assign it
to <code class="docutils literal notranslate"><span class="pre">Document.embedding</span></code>. The whole procedure is in-place and there is no need to return anything.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">jina</span> <span class="kn">import</span> <span class="n">requests</span><span class="p">,</span> <span class="n">Executor</span><span class="p">,</span> <span class="n">DocumentArray</span>

<span class="kn">from</span> <span class="nn">pods.pn</span> <span class="kn">import</span> <span class="n">get_predict_model</span>


<span class="k">class</span> <span class="nc">PNEncoder</span><span class="p">(</span><span class="n">Executor</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">get_predict_model</span><span class="p">(</span><span class="n">ckpt_path</span><span class="o">=</span><span class="s1">'ckpt'</span><span class="p">,</span> <span class="n">num_class</span><span class="o">=</span><span class="mi">2260</span><span class="p">)</span>

    <span class="nd">@requests</span>
    <span class="k">def</span> <span class="nf">encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="p">:</span> <span class="n">DocumentArray</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">_blob</span><span class="p">,</span> <span class="n">_docs</span> <span class="o">=</span> <span class="n">docs</span><span class="o">.</span><span class="n">traverse_flat</span><span class="p">([</span><span class="s1">'c'</span><span class="p">])</span><span class="o">.</span><span class="n">get_attributes_with_docs</span><span class="p">(</span><span class="s1">'blob'</span><span class="p">)</span>
        <span class="n">embeds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">_blob</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">d</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">_docs</span><span class="p">,</span> <span class="n">embeds</span><span class="p">):</span>
            <span class="n">d</span><span class="o">.</span><span class="n">embedding</span> <span class="o">=</span> <span class="n">b</span>
</pre></div>
</div>
</div>
<div class="section" id="example-2-add-chunks-by-segmenting-document">
<h3>Example 2: Add Chunks by Segmenting Document<a class="headerlink" href="#example-2-add-chunks-by-segmenting-document" title="Permalink to this headline">¶</a></h3>
<p>In this example, each <code class="docutils literal notranslate"><span class="pre">Document</span></code> is segmented by <code class="docutils literal notranslate"><span class="pre">get_mesh</span></code> and the results are added to <code class="docutils literal notranslate"><span class="pre">.chunks</span></code>. After
that, <code class="docutils literal notranslate"><span class="pre">.buffer</span></code> and <code class="docutils literal notranslate"><span class="pre">.uri</span></code> are removed from each <code class="docutils literal notranslate"><span class="pre">Document</span></code>. In this case, all changes happen in-place and there is no
need to return anything.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jina</span> <span class="kn">import</span> <span class="n">requests</span><span class="p">,</span> <span class="n">Document</span><span class="p">,</span> <span class="n">Executor</span><span class="p">,</span> <span class="n">DocumentArray</span>


<span class="k">class</span> <span class="nc">ConvertSegmenter</span><span class="p">(</span><span class="n">Executor</span><span class="p">):</span>

    <span class="nd">@requests</span>
    <span class="k">def</span> <span class="nf">segment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="p">:</span> <span class="n">DocumentArray</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">docs</span><span class="p">:</span>
            <span class="n">d</span><span class="o">.</span><span class="n">convert_uri_to_buffer</span><span class="p">()</span>
            <span class="n">d</span><span class="o">.</span><span class="n">chunks</span> <span class="o">=</span> <span class="p">[</span><span class="n">Document</span><span class="p">(</span><span class="n">blob</span><span class="o">=</span><span class="n">_r</span><span class="p">[</span><span class="s1">'blob'</span><span class="p">],</span> <span class="n">tags</span><span class="o">=</span><span class="n">_r</span><span class="p">[</span><span class="s1">'tags'</span><span class="p">])</span> <span class="k">for</span> <span class="n">_r</span> <span class="ow">in</span> <span class="n">get_mesh</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">content</span><span class="p">)]</span>
            <span class="n">d</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">'buffer'</span><span class="p">,</span> <span class="s1">'uri'</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="example-3-preserve-document-id-only">
<h3>Example 3: Preserve Document <code class="docutils literal notranslate"><span class="pre">id</span></code> Only<a class="headerlink" href="#example-3-preserve-document-id-only" title="Permalink to this headline">¶</a></h3>
<p>In this example, a simple indexer stores incoming <code class="docutils literal notranslate"><span class="pre">docs</span></code> in a <code class="docutils literal notranslate"><span class="pre">DocumentArray</span></code>. Then it recreates a new <code class="docutils literal notranslate"><span class="pre">DocumentArray</span></code>
by preserving only <code class="docutils literal notranslate"><span class="pre">id</span></code> in the original <code class="docutils literal notranslate"><span class="pre">docs</span></code> and dropping all others, as the developer does not want to carry all rich
info over the network. This needs a return.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jina</span> <span class="kn">import</span> <span class="n">requests</span><span class="p">,</span> <span class="n">Document</span><span class="p">,</span> <span class="n">Executor</span><span class="p">,</span> <span class="n">DocumentArray</span>


<span class="k">class</span> <span class="nc">MyIndexer</span><span class="p">(</span><span class="n">Executor</span><span class="p">):</span>
    <span class="sd">"""Simple indexer class """</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_docs</span> <span class="o">=</span> <span class="n">DocumentArray</span><span class="p">()</span>

    <span class="nd">@requests</span><span class="p">(</span><span class="n">on</span><span class="o">=</span><span class="s1">'/index'</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="p">:</span> <span class="n">DocumentArray</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_docs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">DocumentArray</span><span class="p">([</span><span class="n">Document</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">docs</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="yaml-interface">
<h2>YAML Interface<a class="headerlink" href="#yaml-interface" title="Permalink to this headline">¶</a></h2>
<p>An Executor can be loaded from and stored to a YAML file. The YAML file has the following format:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">jtype</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">MyExecutor</span>
<span class="nt">with</span><span class="p">:</span>
  <span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="nt">metas</span><span class="p">:</span>
  <span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="nt">requests</span><span class="p">:</span>
  <span class="l l-Scalar l-Scalar-Plain">...</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">jtype</span></code> is a string. Defines the class name, interchangeable with bang mark <code class="docutils literal notranslate"><span class="pre">!</span></code>;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">with</span></code> is a map. Defines kwargs of the class <code class="docutils literal notranslate"><span class="pre">__init__</span></code> method</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">metas</span></code> is a dictionary. It defines the meta information of that class. It contains the following fields:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code> is a string. Defines the name of the executor;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">description</span></code> is a string. Defines the description of this executor. It will be used in automatic docs UI;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">workspace</span></code> is a string. Defines the workspace of the executor;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">py_modules</span></code> is a list of strings. Defines the Python dependencies of the executor;</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">requests</span></code> is a map. Defines the mapping from endpoint to class method name;</p></li>
</ul>
</div>
<div class="section" id="load-and-save-executor-s-yaml-config">
<h2>Load and Save Executor’s YAML config<a class="headerlink" href="#load-and-save-executor-s-yaml-config" title="Permalink to this headline">¶</a></h2>
<p>You can use class method <code class="docutils literal notranslate"><span class="pre">Executor.load_config</span></code> and object method <code class="docutils literal notranslate"><span class="pre">exec.save_config</span></code> to load and save YAML config:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jina</span> <span class="kn">import</span> <span class="n">Executor</span>


<span class="k">class</span> <span class="nc">MyExecutor</span><span class="p">(</span><span class="n">Executor</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bar</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bar</span> <span class="o">=</span> <span class="n">bar</span>

    <span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">pass</span>


<span class="n">y_literal</span> <span class="o">=</span> <span class="s2">"""</span>
<span class="s2">jtype: MyExecutor</span>
<span class="s2">with:</span>
<span class="s2">  bar: 123</span>
<span class="s2">metas:</span>
<span class="s2">  name: awesomeness</span>
<span class="s2">  description: my first awesome executor</span>
<span class="s2">requests:</span>
<span class="s2">  /random_work: foo</span>
<span class="s2">"""</span>

<span class="n">exec</span> <span class="o">=</span> <span class="n">Executor</span><span class="o">.</span><span class="n">load_config</span><span class="p">(</span><span class="n">y_literal</span><span class="p">)</span>
<span class="n">exec</span><span class="o">.</span><span class="n">save_config</span><span class="p">(</span><span class="s1">'y.yml'</span><span class="p">)</span>
<span class="n">Executor</span><span class="o">.</span><span class="n">load_config</span><span class="p">(</span><span class="s1">'y.yml'</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="use-executor-out-of-the-flow">
<h2>Use Executor out of the Flow<a class="headerlink" href="#use-executor-out-of-the-flow" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">Executor</span></code> object can be used directly just like a regular Python object. For example,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jina</span> <span class="kn">import</span> <span class="n">Executor</span><span class="p">,</span> <span class="n">requests</span><span class="p">,</span> <span class="n">DocumentArray</span><span class="p">,</span> <span class="n">Document</span>


<span class="k">class</span> <span class="nc">MyExec</span><span class="p">(</span><span class="n">Executor</span><span class="p">):</span>

    <span class="nd">@requests</span>
    <span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">docs</span><span class="p">:</span>
            <span class="n">d</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">'hello world'</span>


<span class="n">m</span> <span class="o">=</span> <span class="n">MyExec</span><span class="p">()</span>
<span class="n">da</span> <span class="o">=</span> <span class="n">DocumentArray</span><span class="p">([</span><span class="n">Document</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s1">'test'</span><span class="p">)])</span>
<span class="n">m</span><span class="o">.</span><span class="n">foo</span><span class="p">(</span><span class="n">da</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">da</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>DocumentArray has 1 items:
{'id': '20213a02-bdcd-11eb-abf1-1e008a366d48', 'mime_type': 'text/plain', 'text': 'hello world'}
</pre></div>
</div>
<p>This is useful in debugging an Executor.</p>
</div>
<div class="section" id="close-executor">
<h2>Close Executor<a class="headerlink" href="#close-executor" title="Permalink to this headline">¶</a></h2>
<p>You might need to execute some logic when your executor’s destructor is called. For example, let’s suppose you want to
persist data to the disk (e.g in-memory indexed data, fine-tuned model,…). To do so, you can overwrite the
method <code class="docutils literal notranslate"><span class="pre">close</span></code> and add your logic.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jina</span> <span class="kn">import</span> <span class="n">Executor</span><span class="p">,</span> <span class="n">requests</span><span class="p">,</span> <span class="n">Document</span><span class="p">,</span> <span class="n">DocumentArray</span>


<span class="k">class</span> <span class="nc">MyExec</span><span class="p">(</span><span class="n">Executor</span><span class="p">):</span>

    <span class="nd">@requests</span>
    <span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">docs</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"closing..."</span><span class="p">)</span>


<span class="k">with</span> <span class="n">MyExec</span><span class="p">()</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
    <span class="n">executor</span><span class="o">.</span><span class="n">foo</span><span class="p">(</span><span class="n">DocumentArray</span><span class="p">([</span><span class="n">Document</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s1">'hello world'</span><span class="p">)]))</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>hello world
closing...
</pre></div>
</div>
</div>
</div>

      </article>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="executor-built-in-features.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Executor Built-in Features</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="index.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Executor</div>
                
              </div>
            </a>
        </div>

        <div class="related-information">
              Copyright &#169; Jina AI Limited. All rights reserved.
            |
            Last updated on Aug 27, 2021.
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Executor API</a><ul>
<li><a class="reference internal" href="#inheritance">Inheritance</a></li>
<li><a class="reference internal" href="#init-constructor"><code class="docutils literal notranslate"><span class="pre">__init__</span></code> Constructor</a></li>
<li><a class="reference internal" href="#method-naming">Method naming</a></li>
<li><a class="reference internal" href="#requests-decorator"><code class="docutils literal notranslate"><span class="pre">&#64;requests</span></code> decorator</a><ul>
<li><a class="reference internal" href="#default-binding-requests-without-on">Default binding: <code class="docutils literal notranslate"><span class="pre">&#64;requests</span></code> without <code class="docutils literal notranslate"><span class="pre">on=</span></code></a></li>
<li><a class="reference internal" href="#multiple-bindings-requests-on">Multiple bindings: <code class="docutils literal notranslate"><span class="pre">&#64;requests(on=[...])</span></code></a></li>
<li><a class="reference internal" href="#no-binding">No binding</a></li>
</ul>
</li>
<li><a class="reference internal" href="#method-signature">Method Signature</a></li>
<li><a class="reference internal" href="#method-arguments">Method Arguments</a></li>
<li><a class="reference internal" href="#method-returns">Method Returns</a><ul>
<li><a class="reference internal" href="#example-1-embed-documents-blob">Example 1: Embed Documents <code class="docutils literal notranslate"><span class="pre">blob</span></code></a></li>
<li><a class="reference internal" href="#example-2-add-chunks-by-segmenting-document">Example 2: Add Chunks by Segmenting Document</a></li>
<li><a class="reference internal" href="#example-3-preserve-document-id-only">Example 3: Preserve Document <code class="docutils literal notranslate"><span class="pre">id</span></code> Only</a></li>
</ul>
</li>
<li><a class="reference internal" href="#yaml-interface">YAML Interface</a></li>
<li><a class="reference internal" href="#load-and-save-executor-s-yaml-config">Load and Save Executor’s YAML config</a></li>
<li><a class="reference internal" href="#use-executor-out-of-the-flow">Use Executor out of the Flow</a></li>
<li><a class="reference internal" href="#close-executor">Close Executor</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div>
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/tabs.js"></script>
    <script src="../../_static/design-tabs.js"></script>
    <script src="../../_static/scripts/main.js?digest=e931d09b2a40c1bb82b542effe772014573baf67"></script></body>
</html>